\ProvidesPackage{reviewresponse}[2026/1/16 Review Response v2.0]
% Author: Karl-Ludwig Besser
% Email: k.besser@tu-bs.de

% Updated by Liwenhan Xie (xieliwenhan@yahoo.com)
% Summary of changes:
% - section font configuration
% - abbreviations
% - some bug fixes
%   - section title inconsistency
%   - diff color in the change environment @KarlRaphel
% - support good reference

% Updated by Zaiyan Zhang (1@zzaiyan.com)
% Summary of changes:
% - Bibliography: migrated from biblatex+biber to natbib+bibtex (IEEEtran style)
% - Cover page: merged with cover letter, added formatted info table
% - General comments: fixed counter behavior (no longer increments)
% - General response: fixed label display (now "General Response:")
% - \editor command: added optional parameter for custom titles (e.g., [Associate Editor])
% - \reviewer command: added optional parameter for manual numbering (e.g., [3])
% - Visual: added 3pt rounded corners and fuzzy shadow to comment boxes
% - Typography: standardized paragraph indent to 2em, optimized spacing
% - Customization: added \setdefaultmetaresponse and \setdefaultresponse commands
% - Bibliography page: removed "REFERENCES" header for cleaner appearance

\RequirePackage{kvoptions}
\RequirePackage[breakable,skins]{tcolorbox}
\RequirePackage{xcolor}

%%% Package Options %%%
\DeclareStringOption{editor}
\DeclareStringOption{journal}
\DeclareStringOption{manuscript}
\ProcessKeyvalOptions*
%%%

%%% Variables
\let\editorname\reviewresponse@editor
\let\journal\reviewresponse@journal
\let\manuscript\reviewresponse@manuscript
\newcommand*{\thetitle}{\@title}
\newcommand*{\theauthor}{\@author}
\newcommand*{\thedate}{\@date}

% Default response texts
\newcommand{\defaultmetaresponse}{Thank you for the comment.}
\newcommand{\defaultresponse}{Thank you for the comment.}

% Commands to customize default responses
\newcommand{\setdefaultmetaresponse}[1]{\renewcommand{\defaultmetaresponse}{#1}}
\newcommand{\setdefaultresponse}[1]{\renewcommand{\defaultresponse}{#1}}

%%% Colors
% \definecolor{colorcommentfg}{HTML}{6B9FD7}
\definecolor{colorcommentbg}{HTML}{ededed}
% \definecolor{colorcommentframe}{HTML}{6B9FD7}
\definecolor{colorcommentframe}{HTML}{3C78C8}
%\definecolor{colordark}{RGB}{0,63,87}
%\definecolor{colormedium}{RGB}{0,112,155}
%\definecolor{colorlight}{RGB}{102,180,211}
%\colorlet{colorcommentbg}{colorlight!20}

% \definecolor{colorchangebg}{HTML}{FFB480}
\definecolor{colorchangebg}{HTML}{90BFF0}
\definecolor{colorchangetext}{HTML}{424242}
% \colorlet{colorchangeframe}{black!20}
%%%


%%% General Settings
\setlength{\parindent}{2em}
\setlength{\parskip}{.25em}
\setlength{\headheight}{15pt}
\addtolength{\topmargin}{-3pt}
\renewcommand{\baselinestretch}{1.0}
\textheight 235mm

%%%

%%% Counters
\newcounter{reviewer@counter}
\setcounter{reviewer@counter}{0}
\newcounter{reviewcomment@counter}[reviewer@counter]
\setcounter{reviewcomment@counter}{0}
%%%

%%% Commands
\renewcommand*{\maketitle}{%
	\thispagestyle{empty}
	\begin{center}
		\vspace*{0.3em}
		\textbf{\Large{Cover Letter (\reviewresponse@manuscript)}}\\
		\vspace{1em}
		{\large\reviewresponse@journal}\\
		\vspace{0.5em}
	\end{center}

	\noindent\rule{\textwidth}{0.7pt}
	\begin{center}
		\vspace{-0.7em}
		\renewcommand{\arraystretch}{1.2}
		\begin{tabular}{@{}p{0.2\textwidth}p{0.75\textwidth}@{}}
			\textbf{Manuscript ID:}    & \reviewresponse@manuscript \\
			\textbf{Manuscript Title:} & \@title                    \\
			\textbf{Authors:}          & \@author                   \\
		\end{tabular}
		\vspace{-0.7em}
	\end{center}
	\noindent\rule{\textwidth}{0.7pt}
	\vspace{0.5em}
}

\newcommand{\editor}[1][Meta Review]{
	\clearpage
	\@ifundefined{pdfbookmark}{}{%
		\pdfbookmark[1]{Response to the #1}{hyperref@editor}%
	}%
	\section*{\textbf{Response to the #1}}
}

\newcommand{\reviewer}[1][]{
	\clearpage
	\ifx\relax#1\relax
		\refstepcounter{reviewer@counter}%
	\else
		\setcounter{reviewer@counter}{#1}%
	\fi
	\@ifundefined{pdfbookmark}{}{%
		\pdfbookmark[1]{Reviewer \arabic{reviewer@counter}}{hyperref@reviewer\arabic{reviewer@counter}}%
	}%
	\section*{\textbf{\bfseries{Response to Reviewer \arabic{reviewer@counter}}}}
}
%%%

%%% Blocks %%%
\newenvironment{generalcomment}{%
	\edef\@currentlabel{General Comment}
	\begin{tcolorbox}[adjusted title={General Comment}, fonttitle={\bfseries}, enhanced jigsaw, colbacktitle={colorcommentframe},arc=3pt,boxrule=0em,opacityframe=0,colback={colorcommentbg},drop fuzzy shadow]
		}{\end{tcolorbox}}

\newenvironment{revcomment}[1][]{\refstepcounter{reviewcomment@counter}
	\edef\@currentlabel{Comment \arabic{reviewer@counter}.\arabic{reviewcomment@counter}}
	\begin{tcolorbox}[adjusted title={Comment \arabic{reviewer@counter}.\arabic{reviewcomment@counter}}, fonttitle={\bfseries}, enhanced jigsaw, colbacktitle={colorcommentframe},arc=3pt,opacityframe=0,boxrule=0em,colback={colorcommentbg},drop fuzzy shadow,#1]
		}{\end{tcolorbox}}

\newenvironment{revresponse}[1][\defaultresponse]{%
	\edef\@currentlabel{Response \arabic{reviewer@counter}.\arabic{reviewcomment@counter}}
	\noindent\textbf{Response \arabic{reviewer@counter}.\arabic{reviewcomment@counter}:} #1\par
}{\vspace{1em}}

\newenvironment{revmeta}[1][\defaultmetaresponse]{%
	\edef\@currentlabel{General Response}
	\noindent\textbf{General Response:} #1\par
}{\vspace{1em}}

\newenvironment{changes}{
	\begin{tcolorbox}[breakable,use color stack, left skip=0em,enhanced jigsaw, colframe={colorchangebg}, boxrule=0.1em, leftrule=1.5em, opacityback=0, opacityframe=1, arc=0pt]\color{colorchangetext}
		}
		{\end{tcolorbox}}

% Bibliography command for bibtex
\newcommand{\printpartbibliography}[1]{%
	\begin{thebibliography}{99}
		\footnotesize
		\raggedright
		\nocite{#1}
	\end{thebibliography}
}
